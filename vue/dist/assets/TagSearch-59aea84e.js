import{P as j,ab as ye,d as ae,a_ as pe,au as be,r as F,b0 as _e,x as Ce,u as ge,V as Q,a2 as Z,h as A,c as f,a as J,b1 as xe,b as Ae,f as Ie,b2 as we,a9 as se,b3 as ke,ao as Pe,i as $e,aB as Oe,b4 as Se,b5 as Be,b6 as Ke,b7 as Te,T as Ee,aq as Ne,ap as Re,b8 as Me,b9 as De,v as je,ba as Fe,W as Ue,ad as Ve,bb as Le,bc as qe,o as x,l as B,H as q,s as Y,q as M,t as K,n as v,S as te,y as W,m as V,B as z,C as oe,K as ie,bd as ze,z as re,be as Ge,bf as He,bg as ce,U as ne,R as We}from"./index-63535476.js";import{I as Qe}from"./index-7b85c2c6.js";import"./index-4ecae38a.js";import{a as de,b as Je,c as Xe,M as Ye,r as Ze,u as ea}from"./db-7625db8e.js";import{b as aa}from"./_baseIteratee-9a347b0f.js";import{_ as ta}from"./index-e5cd57a5.js";import{B as ue}from"./button-2bb709fb.js";var na=function(){return{prefixCls:String,activeKey:{type:[Array,Number,String]},defaultActiveKey:{type:[Array,Number,String]},accordion:{type:Boolean,default:void 0},destroyInactivePanel:{type:Boolean,default:void 0},bordered:{type:Boolean,default:void 0},expandIcon:Function,openAnimation:j.object,expandIconPosition:j.oneOf(ye("left","right")),collapsible:{type:String},ghost:{type:Boolean,default:void 0},onChange:Function,"onUpdate:activeKey":Function}},me=function(){return{openAnimation:j.object,prefixCls:String,header:j.any,headerClass:String,showArrow:{type:Boolean,default:void 0},isActive:{type:Boolean,default:void 0},destroyInactivePanel:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},accordion:{type:Boolean,default:void 0},forceRender:{type:Boolean,default:void 0},expandIcon:Function,extra:j.any,panelKey:j.oneOfType([j.string,j.number]),collapsible:{type:String},role:String,onItemClick:{type:Function}}};function ve(n){var e=n;if(!Array.isArray(e)){var t=Ae(e);e=t==="number"||t==="string"?[e]:[]}return e.map(function(l){return String(l)})}const X=ae({compatConfig:{MODE:3},name:"ACollapse",inheritAttrs:!1,props:pe(na(),{accordion:!1,destroyInactivePanel:!1,bordered:!0,openAnimation:be("ant-motion-collapse",!1),expandIconPosition:"left"}),slots:["expandIcon"],setup:function(e,t){var l=t.attrs,c=t.slots,s=t.emit,o=F(ve(_e([e.activeKey,e.defaultActiveKey])));Ce(function(){return e.activeKey},function(){o.value=ve(e.activeKey)},{deep:!0});var p=ge("collapse",e),m=p.prefixCls,$=p.direction,T=Q(function(){var d=e.expandIconPosition;return d!==void 0?d:$.value==="rtl"?"right":"left"}),h=function(r){var u=e.expandIcon,b=u===void 0?c.expandIcon:u,_=b?b(r):f(ke,{rotate:r.isActive?90:void 0},null);return f("div",null,[Pe(Array.isArray(b)?_[0]:_)?se(_,{class:"".concat(m.value,"-arrow")},!1):_])},E=function(r){e.activeKey===void 0&&(o.value=r);var u=e.accordion?r[0]:r;s("update:activeKey",u),s("change",u)},O=function(r){var u=o.value;if(e.accordion)u=u[0]===r?[]:[r];else{u=$e(u);var b=u.indexOf(r),_=b>-1;_?u.splice(b,1):u.push(r)}E(u)},D=function(r,u){var b,_,R;if(!we(r)){var a=o.value,i=e.accordion,C=e.destroyInactivePanel,P=e.collapsible,S=e.openAnimation,I=String((b=r.key)!==null&&b!==void 0?b:u),k=r.props||{},w=k.header,g=w===void 0?(_=r.children)===null||_===void 0||(R=_.header)===null||R===void 0?void 0:R.call(_):w,G=k.headerClass,y=k.collapsible,L=k.disabled,U=!1;i?U=a[0]===I:U=a.indexOf(I)>-1;var H=y??P;(L||L==="")&&(H="disabled");var he={key:I,panelKey:I,header:g,headerClass:G,isActive:U,prefixCls:m.value,destroyInactivePanel:C,openAnimation:S,accordion:i,onItemClick:H==="disabled"?null:O,expandIcon:h,collapsible:H};return se(r,he)}},N=function(){var r;return Ie((r=c.default)===null||r===void 0?void 0:r.call(c)).map(D)};return function(){var d,r=e.accordion,u=e.bordered,b=e.ghost,_=Z((d={},A(d,m.value,!0),A(d,"".concat(m.value,"-borderless"),!u),A(d,"".concat(m.value,"-icon-position-").concat(T.value),!0),A(d,"".concat(m.value,"-rtl"),$.value==="rtl"),A(d,"".concat(m.value,"-ghost"),!!b),A(d,l.class,!!l.class),d));return f("div",J(J({class:_},xe(l)),{},{style:l.style,role:r?"tablist":null}),[N()])}}}),la=ae({compatConfig:{MODE:3},name:"PanelContent",props:me(),setup:function(e,t){var l=t.slots,c=F(!1);return Oe(function(){(e.isActive||e.forceRender)&&(c.value=!0)}),function(){var s,o;if(!c.value)return null;var p=e.prefixCls,m=e.isActive,$=e.role;return f("div",{ref:F,class:Z("".concat(p,"-content"),(s={},A(s,"".concat(p,"-content-active"),m),A(s,"".concat(p,"-content-inactive"),!m),s)),role:$},[f("div",{class:"".concat(p,"-content-box")},[(o=l.default)===null||o===void 0?void 0:o.call(l)])])}}}),ee=ae({compatConfig:{MODE:3},name:"ACollapsePanel",inheritAttrs:!1,props:pe(me(),{showArrow:!0,isActive:!1,onItemClick:function(){},headerClass:"",forceRender:!1}),slots:["expandIcon","extra","header"],setup:function(e,t){var l=t.slots,c=t.emit,s=t.attrs;Se(e.disabled===void 0,"Collapse.Panel",'`disabled` is deprecated. Please use `collapsible="disabled"` instead.');var o=ge("collapse",e),p=o.prefixCls,m=function(){c("itemClick",e.panelKey)},$=function(h){(h.key==="Enter"||h.keyCode===13||h.which===13)&&m()};return function(){var T,h,E,O,D=e.header,N=D===void 0?(T=l.header)===null||T===void 0?void 0:T.call(l):D,d=e.headerClass,r=e.isActive,u=e.showArrow,b=e.destroyInactivePanel,_=e.accordion,R=e.forceRender,a=e.openAnimation,i=e.expandIcon,C=i===void 0?l.expandIcon:i,P=e.extra,S=P===void 0?(h=l.extra)===null||h===void 0?void 0:h.call(l):P,I=e.collapsible,k=I==="disabled",w=p.value,g=Z("".concat(w,"-header"),(E={},A(E,d,d),A(E,"".concat(w,"-header-collapsible-only"),I==="header"),E)),G=Z((O={},A(O,"".concat(w,"-item"),!0),A(O,"".concat(w,"-item-active"),r),A(O,"".concat(w,"-item-disabled"),k),A(O,"".concat(w,"-no-arrow"),!u),A(O,"".concat(s.class),!!s.class),O)),y=f("i",{class:"arrow"},null);u&&typeof C=="function"&&(y=C(e));var L=Be(f(la,{prefixCls:w,isActive:r,forceRender:R,role:_?"tabpanel":null},{default:l.default}),[[Te,r]]),U=J({appear:!1,css:!1},a);return f("div",J(J({},s),{},{class:G}),[f("div",{class:g,onClick:function(){return I!=="header"&&m()},role:_?"tab":"button",tabindex:k?-1:0,"aria-expanded":r,onKeypress:$},[u&&y,I==="header"?f("span",{onClick:m,class:"".concat(w,"-header-text")},[N]):N,S&&f("div",{class:"".concat(w,"-extra")},[S])]),f(Ke,U,{default:function(){return[!b||r?L:null]}})])}}});X.Panel=ee;X.install=function(n){return n.component(X.name,X),n.component(ee.name,ee),n};var sa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 000-48.4z"}}]},name:"arrow-right",theme:"outlined"};const oa=sa;function fe(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(t).filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),l.forEach(function(c){ia(n,c,t[c])})}return n}function ia(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var le=function(e,t){var l=fe({},e,t.attrs);return f(Ee,fe({},l,{icon:oa}),null)};le.displayName="ArrowRightOutlined";le.inheritAttrs=!1;const ra=le;function ca(n,e,t,l){for(var c=-1,s=n==null?0:n.length;++c<s;){var o=n[c];e(l,o,t(o),n)}return l}function da(n){return function(e,t,l){for(var c=-1,s=Object(e),o=l(e),p=o.length;p--;){var m=o[n?p:++c];if(t(s[m],m,s)===!1)break}return e}}var ua=da();const va=ua;function fa(n,e){return n&&va(n,e,Ne)}function pa(n,e){return function(t,l){if(t==null)return t;if(!Re(t))return n(t,l);for(var c=t.length,s=e?c:-1,o=Object(t);(e?s--:++s<c)&&l(o[s],s,o)!==!1;);return t}}var ga=pa(fa);const ma=ga;function ha(n,e,t,l){return ma(n,function(c,s,o){e(l,c,t(c),o)}),l}function ya(n,e){return function(t,l){var c=Me(t)?ca:ha,s=e?e():{};return c(t,n,aa(l),s)}}var ba=Object.prototype,_a=ba.hasOwnProperty,Ca=ya(function(n,e,t){_a.call(n,t)?n[t].push(e):De(n,t,[e])});const xa=Ca;const Aa={class:"container"},Ia={class:"search-bar"},wa={class:"form-name"},ka={class:"search-bar"},Pa={class:"form-name"},$a={class:"search-bar"},Oa={class:"form-name"},Sa={key:0,class:"generate-idx-hint"},Ba={class:"list-container"},Ka=["onClick"],Ta=["onClick"],Ea=["onClickCapture"],Na=ae({__name:"TagSearch",props:{tabIdx:null,paneIdx:null},setup(n){const e=n,t=je(),l=Fe(),c=Q(()=>!l.isIdle),s=F(),o=F({and_tags:[],or_tags:[],not_tags:[]}),p=Q(()=>s.value?s.value.tags.slice().sort((a,i)=>i.count-a.count):[]),m=["custom","Model","lora","pos","size","Postprocess upscaler","Postprocess upscale by","Sampler"].reduce((a,i,C)=>(a[i]=C,a),{}),$=Q(()=>Object.entries(xa(p.value,a=>a.type)).sort((a,i)=>m[a[0]]-m[i[0]])),T=Ue(),h=F($.value.map(a=>a[0]));Ve(async()=>{s.value=await de(),h.value=$.value.map(a=>a[0]),s.value.img_count&&s.value.expired&&E()});const E=Le(()=>l.pushAction(async()=>(await ea(),s.value=await de(),h.value=$.value.map(a=>a[0]),s.value)).res),O=()=>{t.openTagSearchMatchedImageGridInRight(e.tabIdx,T,o.value)};qe("return-to-iib",async()=>{const a=await l.pushAction(Je).res;s.value.expired=a.expired});const D=(a,i=!1)=>(i?`[${a.type}] `:"")+(a.display_name?`${a.display_name} : ${a.name}`:a.name),N=F(!1),d=F(""),r=async()=>{var i,C,P;if(!d.value){N.value=!1;return}const a=await l.pushAction(()=>Xe({tag_name:d.value})).res;a.type!=="custom"&&ce.error(ne("existInOtherType")),(i=s.value)!=null&&i.tags.find(S=>S.id===a.id)?ce.error(ne("alreadyExists")):((C=s.value)==null||C.tags.push(a),(P=t.conf)==null||P.all_custom_tags.push(a)),d.value="",N.value=!1},u=a=>{Ye.confirm({title:ne("confirmDelete"),async onOk(){var C,P,S,I;await Ze({tag_id:a});const i=((C=s.value)==null?void 0:C.tags.findIndex(k=>k.id===a))??-1;(P=s.value)==null||P.tags.splice(i,1),(I=t.conf)==null||I.all_custom_tags.splice((S=t.conf)==null?void 0:S.all_custom_tags.findIndex(k=>k.id===a),1)}})},b=Q(()=>new Set([o.value.and_tags,o.value.or_tags,o.value.not_tags].flat())),_=a=>{b.value.has(a.id)?(o.value.and_tags=o.value.and_tags.filter(i=>i!==a.id),o.value.or_tags=o.value.or_tags.filter(i=>i!==a.id),o.value.not_tags=o.value.not_tags.filter(i=>i!==a.id)):o.value.and_tags.push(a.id)},R={value:a=>a.id,text:D,optionText:a=>D(a,!0)};return(a,i)=>{const C=ue,P=Qe,S=ue,I=ta,k=ee,w=X;return x(),B("div",Aa,[q("",!0),s.value?(x(),B(Y,{key:1},[M("div",null,[M("div",Ia,[M("div",wa,K(a.$t("exactMatch")),1),f(v(te),{conv:R,mode:"multiple",style:{width:"100%"},options:v(p),value:o.value.and_tags,"onUpdate:value":i[0]||(i[0]=g=>o.value.and_tags=g),disabled:!v(p).length,placeholder:a.$t("selectExactMatchTag")},null,8,["options","value","disabled","placeholder"]),s.value.expired||!s.value.img_count?(x(),W(C,{key:0,onClick:v(E),loading:!v(l).isIdle,type:"primary"},{default:V(()=>[z(K(s.value.img_count===0?a.$t("generateIndexHint"):a.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(x(),W(C,{key:1,type:"primary",onClick:O,loading:!v(l).isIdle,disabled:!o.value.and_tags.length},{default:V(()=>[z(K(a.$t("search")),1)]),_:1},8,["loading","disabled"]))]),M("div",ka,[M("div",Pa,K(a.$t("anyMatch")),1),f(v(te),{conv:R,mode:"multiple",style:{width:"100%"},options:v(p),value:o.value.or_tags,"onUpdate:value":i[1]||(i[1]=g=>o.value.or_tags=g),disabled:!v(p).length,placeholder:a.$t("selectAnyMatchTag")},null,8,["options","value","disabled","placeholder"])]),M("div",$a,[M("div",Oa,K(a.$t("exclude")),1),f(v(te),{conv:R,mode:"multiple",style:{width:"100%"},options:v(p),value:o.value.not_tags,"onUpdate:value":i[2]||(i[2]=g=>o.value.not_tags=g),disabled:!v(p).length,placeholder:a.$t("selectExcludeTag")},null,8,["options","value","disabled","placeholder"])])]),v(p).filter(g=>g.type!=="custom").length?q("",!0):(x(),B("p",Sa,K(a.$t("needGenerateIdx")),1)),M("div",Ba,[(x(!0),B(Y,null,oe(v($),([g,G])=>(x(),B("ul",{class:"tag-list",key:g},[M("h3",{class:"cat-name",onClick:y=>h.value.includes(g)?h.value.splice(h.value.indexOf(g),1):h.value.push(g)},[f(v(ra),{class:ie(["arrow",{down:h.value.includes(g)}])},null,8,["class"]),z(" "+K(a.$t(g)),1)],8,Ka),f(w,{ghost:"",activeKey:h.value,"onUpdate:activeKey":i[5]||(i[5]=y=>h.value=y)},{expandIcon:V(()=>[]),default:V(()=>[(x(),W(k,{key:g},{default:V(()=>[(x(!0),B(Y,null,oe(G,(y,L)=>(x(),B("li",{key:y.id,class:ie(["tag",{selected:v(b).has(y.id)}]),onClick:U=>_(y)},[v(b).has(y.id)?(x(),W(v(ze),{key:0})):q("",!0),z(" "+K(D(y))+" ",1),g==="custom"&&L!==0?(x(),B("span",{key:1,class:"remove",onClickCapture:re(U=>u(y.id),["stop"])},[f(v(Ge))],40,Ea)):q("",!0)],10,Ta))),128)),g==="custom"?(x(),B("li",{key:0,class:"tag",onClick:i[4]||(i[4]=y=>N.value=!0)},[N.value?(x(),W(I,{key:0,compact:""},{default:V(()=>[f(P,{value:d.value,"onUpdate:value":i[3]||(i[3]=y=>d.value=y),style:{width:"128px"},loading:v(c),"allow-clear":"",size:"small"},null,8,["value","loading"]),f(S,{size:"small",type:"primary",onClickCapture:re(r,["stop"]),loading:v(c)},{default:V(()=>[z(K(d.value?a.$t("submit"):a.$t("cancel")),1)]),_:1},8,["onClickCapture","loading"])]),_:1})):(x(),B(Y,{key:1},[f(v(He)),z(" "+K(a.$t("add")),1)],64))])):q("",!0)]),_:2},1024))]),_:2},1032,["activeKey"])]))),128))])],64)):q("",!0)])}}});const La=We(Na,[["__scopeId","data-v-80adb7a3"]]);export{La as default};
