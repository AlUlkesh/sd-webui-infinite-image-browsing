import{ax as N,aw as V,cc as D,b$ as E,d as U,V as q,aW as G,a$ as L,r as $,A as B,aa as M,p as P,K as u,L as p,$ as _,x as k,T as y,c as j,O as g,a2 as z,W as x,N as S,Y as w,U as v,Z as A,a4 as W,cg as H,a8 as K}from"./index-8055eb0e.js";/* empty css              */import{a as C,u as Q}from"./db-b6f52049.js";import{b as Y}from"./_baseIteratee-011cf2cf.js";import{B as Z}from"./button-2d1093df.js";function J(s,n,a,o){for(var e=-1,t=s==null?0:s.length;++e<t;){var i=s[e];n(o,i,a(i),s)}return o}function R(s){return function(n,a,o){for(var e=-1,t=Object(n),i=o(n),h=i.length;h--;){var f=i[s?h:++e];if(a(t[f],f,t)===!1)break}return n}}var X=R();const ee=X;function ae(s,n){return s&&ee(s,n,N)}function te(s,n){return function(a,o){if(a==null)return a;if(!V(a))return s(a,o);for(var e=a.length,t=n?e:-1,i=Object(a);(n?t--:++t<e)&&o(i[t],t,i)!==!1;);return a}}var se=te(ae);const ne=se;function re(s,n,a,o){return ne(s,function(e,t,i){n(o,e,a(e),i)}),o}function oe(s,n){return function(a,o){var e=D(a)?J:re,t=n?n():{};return e(a,s,Y(o),t)}}var ie=Object.prototype,le=ie.hasOwnProperty,ue=oe(function(s,n,a){le.call(s,a)?s[a].push(n):E(s,a,[n])});const ce=ue,de={class:"container"},pe={class:"search-bar"},ge={key:0,class:"generate-idx-hint"},he={class:"list-container"},ve={class:"cat-name"},fe=["onClick"],me=U({__name:"TagSearch",props:{tabIdx:null,paneIdx:null},setup(s){const n=s,a=q(),o=G(new L(-1,0,-1,"throw")),e=$(),t=$(new Set),i=B(()=>e.value?e.value.tags.slice().sort((r,l)=>l.count-r.count):[]),h=["Model","Sampler","lora","pos","size"].reduce((r,l,m)=>(r[l]=m,r),{}),f=B(()=>Object.entries(ce(i.value,r=>r.type)).sort((r,l)=>h[r[0]]-h[l[0]])),O=M();P(async()=>{e.value=await C(),e.value.img_count&&e.value.expired&&I()});const I=async()=>{o.pushAction(async()=>{await Q(),e.value=await C()})},T=()=>{a.openTagSearchMatchedImageGridInRight(n.tabIdx,O,Array.from(t.value))},b=(r,l=!1)=>(l?`[${r.type}] `:"")+(r.display_name?`${r.display_name} : ${r.name}`:r.name);return(r,l)=>{const m=Z;return u(),p("div",de,[_("",!0),e.value?(u(),p(k,{key:1},[y("div",null,[y("div",pe,[j(g(z),{conv:{value:c=>c.id,text:b,optionText:c=>b(c,!0)},mode:"multiple",style:{width:"100%"},options:g(i),value:Array.from(t.value),disabled:!g(i).length,placeholder:"Select tags to match images","onUpdate:value":l[0]||(l[0]=c=>t.value=new Set(c))},null,8,["conv","options","value","disabled"]),e.value.expired||!e.value.img_count?(u(),x(m,{key:0,onClick:I,loading:!o.isIdle,type:"primary"},{default:S(()=>[w(v(e.value.img_count===0?r.$t("generateIndexHint"):r.$t("UpdateIndex")),1)]),_:1},8,["loading"])):(u(),x(m,{key:1,type:"primary",onClick:T,loading:!o.isIdle,disabled:!t.value.size},{default:S(()=>[w(v(r.$t("search")),1)]),_:1},8,["loading","disabled"]))])]),g(i).length?_("",!0):(u(),p("p",ge,v(r.$t("needGenerateIdx")),1)),y("div",he,[(u(!0),p(k,null,A(g(f),([c,F])=>(u(),p("ul",{class:"tag-list",key:c},[y("h3",ve,v(r.$t(c)),1),(u(!0),p(k,null,A(F,d=>(u(),p("li",{key:d.id,class:W(["tag",{selected:t.value.has(d.id)}]),onClick:_e=>t.value.has(d.id)?t.value.delete(d.id):t.value.add(d.id)},[t.value.has(d.id)?(u(),x(g(H),{key:0})):_("",!0),w(" "+v(b(d)),1)],10,fe))),128))]))),128))])],64)):_("",!0)])}}});const Ie=K(me,[["__scopeId","data-v-8c324b9d"]]);export{Ie as default};
