import{d as j,r as B,ac as H,b2 as J,b3 as K,o as a,l as k,c as o,y as m,m as r,B as C,t as v,n as e,J as f,p as $,q as A,A as W,I as V,b7 as X,T as Y,L as Z,Q as ee}from"./index-4a2169ff.js";import{i as te,j as se,t as ie,L as ne,R as le,k as ae,S as oe}from"./fullScreenContextMenu-726eab7c.js";import{I as re}from"./index-30174a88.js";import{a as U,b as ue,d as de,M as ce,u as pe}from"./db-267adb61.js";import{u as me}from"./hook-1a4757cd.js";import{B as ve}from"./button-bdfaf6a0.js";import"./index-aec6f11e.js";import"./_baseIteratee-b77b0e83.js";const fe={key:0,class:"search-bar"},ge={class:"hint"},ke={key:1,class:"preview-switch"},Ce=j({__name:"SubstrSearch",setup(be){const{queue:u,images:n,onContextMenuClickU:b,stackViewEl:D,previewIdx:d,previewing:w,onPreviewVisibleChange:E,previewImgMove:y,canPreview:I,itemSize:_,gridItems:F,showGenInfo:c,imageGenInfo:x,q:R,multiSelectedIdxs:T,onFileItemClick:q,scroller:h,showMenuIdx:g}=me(),p=B(""),s=B();H(async()=>{s.value=await U(),s.value.img_count&&s.value.expired&&S()});const S=J(()=>u.pushAction(async()=>(await pe(),s.value=await U(),s.value)).res),L=async()=>{var i;n.value=await u.pushAction(()=>de(p.value)).res,(i=h.value)==null||i.scrollToItem(0),n.value.length||X.info(Y("fuzzy-search-noResults"))};return K("return-to-iib",async()=>{const i=await u.pushAction(ue).res;s.value.expired=i.expired}),(i,t)=>{const N=re,M=ve,P=Z,G=ce,O=oe;return a(),k("div",{class:"container",ref_key:"stackViewEl",ref:D},[s.value?(a(),k("div",fe,[o(N,{value:p.value,"onUpdate:value":t[0]||(t[0]=l=>p.value=l),placeholder:i.$t("fuzzy-search-placeholder")},null,8,["value","placeholder"]),s.value.expired||!s.value.img_count?(a(),m(M,{key:0,onClick:e(S),loading:!e(u).isIdle,type:"primary"},{default:r(()=>[C(v(s.value.img_count===0?i.$t("generateIndexHint"):i.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(a(),m(M,{key:1,type:"primary",onClick:L,loading:!e(u).isIdle,disabled:!p.value},{default:r(()=>[C(v(i.$t("search")),1)]),_:1},8,["loading","disabled"]))])):f("",!0),o(O,{size:"large",spinning:!e(u).isIdle},{default:r(()=>[o(G,{visible:e(c),"onUpdate:visible":t[2]||(t[2]=l=>$(c)?c.value=l:null),width:"70vw","mask-closable":"",onOk:t[3]||(t[3]=l=>c.value=!1)},{cancelText:r(()=>[]),default:r(()=>[o(P,{active:"",loading:!e(R).isIdle},{default:r(()=>[A("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:t[1]||(t[1]=l=>e(W)(e(x)))},[A("div",ge,v(i.$t("doubleClickToCopy")),1),C(" "+v(e(x)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),e(n)?(a(),m(e(te),{key:0,ref_key:"scroller",ref:h,class:"file-list",items:e(n),"item-size":e(_).first,"key-field":"fullpath","item-secondary-size":e(_).second,gridItems:e(F)},{default:r(({item:l,index:z})=>[o(se,{idx:z,file:l,"show-menu-idx":e(g),"onUpdate:showMenuIdx":t[4]||(t[4]=Q=>$(g)?g.value=Q:null),onFileItemClick:e(q),"full-screen-preview-image-url":e(n)[e(d)]?e(ie)(e(n)[e(d)]):"",selected:e(T).includes(z),onContextMenuClick:e(b),onPreviewVisibleChange:e(E)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","selected","onContextMenuClick","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems"])):f("",!0),e(w)?(a(),k("div",ke,[o(e(ne),{onClick:t[5]||(t[5]=l=>e(y)("prev")),class:V({disable:!e(I)("prev")})},null,8,["class"]),o(e(le),{onClick:t[6]||(t[6]=l=>e(y)("next")),class:V({disable:!e(I)("next")})},null,8,["class"])])):f("",!0)]),_:1},8,["spinning"]),e(w)&&e(n)&&e(n)[e(d)]?(a(),m(ae,{key:1,file:e(n)[e(d)],idx:e(d),onContextMenuClick:e(b)},null,8,["file","idx","onContextMenuClick"])):f("",!0)],512)}}});const ze=ee(Ce,[["__scopeId","data-v-2feb1838"]]);export{ze as default};
