import{bH as w,d as E,J as G,b6 as Q,r as y,G as R,y as j,K as o,L as m,a as p,N as i,M as e,V as k,U as d,R as r,aj as B,W as z,O as h,X as H,Y as L,ax as J,Q as A,bw as K,S as W,a0 as X}from"./index-c8cb069d.js";import{u as Y,b as P,f as Z,d as ee,i as te,h as ae,M as se}from"./FileItem-8299ccce.js";import{c as oe}from"./copy2clipboard-1c1b6705.js";import{B as ne}from"./button-412d5753.js";import"./index-7122bb4c.js";import"./styleChecker-8445ad43.js";import"./useTaskListStore-be77fcbc.js";import"./EyeOutlined-921aebd6.js";const T=async()=>(await w.get("/db/basic_info")).data,ie=async()=>{await w.post("/db/update_image_data",{},{timeout:1/0})},le=async _=>(await w.get("/db/match_images_by_tags",{params:{tag_ids:_.join()}})).data,ce={class:"hint"},de={class:"tag-list"},re=["onClick"],ue=E({__name:"TagSearch",setup(_){const l=G(new Q),s=y(),n=y(new Set),x=R(()=>s.value?s.value.tags.slice().sort((c,a)=>a.count-c.count):[]),I=y();j(async()=>{s.value=await T(),console.log(s,x)});const V=async()=>{l.pushAction(async()=>{await ie(),s.value=await T()})},b={tabIdx:-1,target:"local",paneIdx:-1},{stackViewEl:N}=Y().toRefs(),{itemSize:v,gridItems:f}=P(b),{showMenuIdx:g}=Z(),{showGenInfo:u,imageGenInfo:C,q:D,onContextMenuClick:$}=ee(b,{openNext:K}),F=async()=>{console.log(v.value,f.value);const{res:c}=l.pushAction(()=>le(Array.from(n.value)));I.value=await c};return(c,a)=>{const O=W,U=se,M=ne;return o(),m("div",{class:"container",ref_key:"stackViewEl",ref:N},[p(U,{visible:e(u),"onUpdate:visible":a[1]||(a[1]=t=>B(u)?u.value=t:null),width:"70vw","mask-closable":"",onOk:a[2]||(a[2]=t=>u.value=!1)},{cancelText:i(()=>[]),default:i(()=>[p(O,{active:"",loading:!e(D).isIdle},{default:i(()=>[k("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:a[0]||(a[0]=t=>e(oe)(e(C),"copied"))},[k("div",ce,d(c.$t("doubleClickToCopy")),1),r(" "+d(e(C)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),s.value?(o(),m(z,{key:0},[s.value.expired||!s.value.img_count?(o(),h(M,{key:0,onClick:V,loading:!l.isIdle,type:"primary"},{default:i(()=>[r(d(s.value.img_count===0?"gen idx":"updat index"),1)]),_:1},8,["loading"])):(o(),h(M,{key:1,type:"primary",onClick:F,loading:!l.isIdle},{default:i(()=>[r("search")]),_:1},8,["loading"])),k("ul",de,[(o(!0),m(z,null,H(e(x),t=>(o(),m("li",{key:t.id,class:L(["tag",{selected:n.value.has(t.id)}]),onClick:S=>n.value.has(t.id)?n.value.delete(t.id):n.value.add(t.id)},[n.value.has(t.id)?(o(),h(e(J),{key:0})):A("",!0),r(" "+d(t.name),1)],10,re))),128))])],64)):A("",!0),r(" "+d(e(f))+" ",1),p(e(ae),{class:"file-list",items:I.value||[],"item-size":e(v).first,"key-field":"fullpath","item-secondary-size":e(v).second,gridItems:e(f)},{default:i(({item:t,index:S})=>[p(te,{idx:S,file:t,"show-menu-idx":e(g),"onUpdate:showMenuIdx":a[3]||(a[3]=q=>B(g)?g.value=q:null),onContextMenuClick:e($)},null,8,["idx","file","show-menu-idx","onContextMenuClick"])]),_:1},8,["items","item-size","item-secondary-size","gridItems"])],512)}}});const he=X(ue,[["__scopeId","data-v-de62d885"]]);export{he as default};
